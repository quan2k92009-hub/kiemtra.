<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bài kiểm tra trắc nghiệm Lịch Sử</title>
<style>
  body {font-family: Arial, sans-serif; max-width: 700px; margin: 0 auto; padding: 20px;}
  .question {font-size: 18px; font-weight: bold; margin-bottom: 10px;}
  .answers button {
    display: block; 
    width: 100%; 
    margin: 5px 0; 
    padding: 10px; 
    font-size: 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background: #eee;
  }
  .correct {background-color: #4CAF50 !important; color: white;}
  .wrong {background-color: #f44336 !important; color: white;}
  .message {margin-top: 15px; font-size: 16px; font-weight: bold;}
</style>
</head>
<body>

<h1>Bài kiểm tra trắc nghiệm Lịch Sử</h1>
<div id="quiz">
  <div id="question-container"></div>
  <div class="answers" id="answers-container"></div>
  <div class="message" id="message"></div>
</div>

<script>
// ===== DỮ LIỆU =====
const questions = [
"Câu 1: Đầu thế kỉ XVIII, ngành công nghiệp phát triển nhất ở nước Anh là?",
"Câu 2: Đẳng cấp thứ ba trong xã hội Pháp trước cách mạng bao gồm:",
// ... thêm các câu khác như trước ...
];
const options = [
["A. Dệt len","B. Máy hơi nước","C. Luyện kim, chế tạo máy","D. Đóng tàu"],
["A. Tư sản, nông dân, bình dân thành thị","B. Quý tộc, tăng lữ, tư sản","C. Tăng lữ, quý tộc, tư sản","D. Vua, quan lại, tăng lữ, bình dân thành thị"],
// ...
];
const correctAnswers = [
 'A','A','B','B','C','B','A','D','B','D',
 'D','A','B','A','C','B','B','C','A','A',
 'A','A','B','C','C','B','D','C','A','B'
];

// ===== HÀM TRỘN =====
function shuffle(array){
  for (let i = array.length - 1; i > 0; i--){
    let j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// ===== GHÉP DỮ LIỆU =====
let quizData = [];
for (let i = 0; i < questions.length; i++) {
  quizData.push({
    question: questions[i],
    options: options[i].slice(),
    correct: correctAnswers[i],
    scored: null // để đánh dấu đúng/sai lần đầu
  });
}
shuffle(quizData); // trộn câu hỏi

let currentQuestion = 0;
let score = 0;

function showQuestion(index){
  const qContainer = document.getElementById('question-container');
  const aContainer = document.getElementById('answers-container');
  const msg = document.getElementById('message');
  msg.textContent = '';

  const q = quizData[index];

  // Trộn đáp án kèm cờ đúng
  let answersWithFlag = q.options.map((opt,i)=>{
    let letter = String.fromCharCode(65+i);
    return {
      text: opt,
      isCorrect: (letter===q.correct)
    };
  });
  shuffle(answersWithFlag);

  qContainer.innerHTML = `<div class="question">${q.question}</div>`;
  aContainer.innerHTML = '';

  answersWithFlag.forEach(item=>{
    const btn = document.createElement('button');
    btn.textContent = item.text;
    btn.addEventListener('click', ()=>{
      checkAnswer(item.isCorrect, btn);
    });
    aContainer.appendChild(btn);
  });
}

function checkAnswer(isCorrect, button){
  const msg = document.getElementById('message');
  const currentQ = quizData[currentQuestion];

  // Nếu câu này chưa chấm điểm lần nào:
  if (currentQ.scored === null){
    if (isCorrect){
      currentQ.scored = true; // ghi nhận đúng
      score++;
      button.classList.add('correct');
      msg.textContent = "✅ Đúng lần đầu – bạn được 1 điểm!";
      setTimeout(nextQuestion, 1000);
    } else {
      currentQ.scored = false; // ghi nhận sai
      button.classList.add('wrong');
      msg.textContent = "❌ Sai lần đầu – câu này 0 điểm, chọn lại để qua câu mới!";
    }
  } else {
    // đã chọn sai lần đầu → không cộng điểm nữa, nhưng phải chọn đúng mới qua
    if (isCorrect){
      button.classList.add('correct');
      msg.textContent = "✅ Đúng rồi – nhưng không cộng điểm vì sai lần đầu!";
      setTimeout(nextQuestion, 1000);
    } else {
      button.classList.add('wrong');
      msg.textContent = "❌ Sai tiếp – chọn lại!";
    }
  }
}

function nextQuestion(){
  currentQuestion++;
  if (currentQuestion < quizData.length){
    showQuestion(currentQuestion);
  } else {
    document.getElementById('quiz').innerHTML = `<h2>Bạn đã hoàn thành bài kiểm tra!</h2>
    <h3>Điểm của bạn: ${score} / 30</h3>`;
  }
}

// ===== KHỞI TẠO =====
showQuestion(currentQuestion);
</script>

</body>
</html>
